---
title: 리더 선출 & 합의 (Paxos, Raft)
date: '2025-07-02'
tags: [분산시스템, CS, 합의알고리즘, Paxos, Raft]
difficulty: hard
---

# 리더 선출 & 합의 (Paxos, Raft)

## 1. 핵심 개념 (Core Concept)

분산 시스템에서 여러 노드가 데이터의 일관성을 유지하고 시스템 전체가 안정적으로 동작하려면, 모든 노드가 특정 값에 대해 **만장일치로 동의**하는 과정, 즉 \*\*합의(Consensus)\*\*가 필수적입니다. \*\*리더 선출(Leader Election)\*\*은 이러한 합의를 이끌어낼 단일 노드(리더)를 지정하는 과정입니다. **Paxos**와 **Raft**는 네트워크 장애 등 신뢰할 수 없는 환경에서도 합의를 보장하는 대표적인 알고리즘입니다.

______________________________________________________________________

## 2. 상세 설명 (Detailed Explanation)

### 2.1 리더 선출 (Leader Election)

분산 시스템의 여러 노드 중 하나를 **리더**로 지정하여 시스템의 복잡성을 줄이고 효율성을 높이는 과정입니다.

- **리더의 역할**:
  - **작업 조율**: 전체 시스템의 작업을 관리하고 다른 노드(팔로워)에 작업을 분배합니다.
  - **데이터 변경 관리**: 데이터에 대한 모든 쓰기 요청을 리더가 먼저 처리하여 데이터의 일관성을 보장합니다.
  - **상태 결정**: 시스템의 전반적인 상태를 결정하고 이를 다른 노드에 전파합니다.
- **장애 복구**: 리더에 문제가 생기면, 나머지 노드들은 새로운 리더를 선출하여 시스템의 연속성을 유지합니다.

### 2.2 합의 (Consensus) 알고리즘

분산 시스템에 참여하는 노드들이 특정 값에 대해 만장일치로 동의하는 과정을 보장하는 알고리즘입니다. 분산 데이터베이스, 클라우드 인프라 등에서 데이터의 일관성과 내결함성(Fault Tolerance)을 확보하는 데 필수적입니다.

### 2.3 Paxos 알고리즘

레슬리 램포트(Leslie Lamport)가 제안한 최초의 분산 합의 알고리즘으로, 비동기 네트워크 환경에서도 일관성을 보장하는 강력한 이론적 기반을 가지고 있습니다.

- **역할**: Proposer(제안자), Acceptor(수락자), Learner(학습자)로 역할이 나뉩니다.
- **동작 방식**: 'Prepare'와 'Accept'라는 두 단계의 과정을 통해 합의를 이룹니다. 이 과정에서 \*\*과반수(Majority)\*\*의 동의를 얻는 것이 핵심입니다.
- **특징**:
  - **이론적 견고함**: 수학적으로 증명된 안정성을 바탕으로 어떤 상황에서도    이터 일관성이 깨지지 않음을 보장합니다.
  - **높은 복잡성**: 이론이 매우 복잡하고, 실제 시스템으로 구현하기 어렵다는 단점이 있습니다.
  - **비-리더 중심**: 명시적인 리더가 존재하지 않고, 여러 Proposer가 동시에 제안을 시도할 수 있어 경쟁이 발생할 수 있습니다.

### 2.4 Raft 알고리즘

Paxos의 복잡성을 해결하고, 더 이해하기 쉽고 구현하기 용이하게 만드는 것을 목표로 개발된 합의 알고리즘입니다.

- **역할**: Leader(리더), Follower(팔로워), Candidate(후보자)라는 명확한 역할을 가집니다.
- **핵심 아이디어**: Raft는 합의 문제를 **리더 선출(Leader Election)**, **로그 복제(Log Replication)**, \*\*안전성(Safety)\*\*이라는 세 가지 하위 문제로 나누어 단순화했습니다.
- **동작 방식**:
  1. **리더 선출**: Follower는 일정 시간(election timeout) 동안 리더로부터 신호(heartbeat)를 받지 못하면 Candidate가 되어 선거를 시작합니다. 과반수의 표를 얻은 Candidate가 새로운 리더가 됩니다.
  1. **로그 복제**: 모든 데이터 변경은 리더를 통해서만 이루어집니다. 리더는 변경 사항을 로그 항목으로 만들어 자신의 로그에 추가한 뒤, 이를 모든 Follower  게 복제하도록 요청합니다. 과반수의 Follower가 복제를 완료하면 해당 로그는 \*\*커밋(commit)\*\*되어 시스템에 최종 반영됩니다.
- **특징**:
  - **이해 용이성**: Paxos에 비해 동작 방식이 직관적이고 이해하기 쉽습니다.
  - **강력한 리더**: 항상 단 하나의 리더만이 존재하며, 모든 데이터 흐름이 리더에서 팔로워로 향하는 단방향 구조라 관리가 용이합니다.
  - **실용성**: 이해와 구현의 용이성 덕분에 etcd, Consul 등 다수의 실제 분산 시스템에서 널리 사용되고 있습니다.

### 2.5 비교 요약

| 구분               | Paxos                                       | Raft                                                    |
| :----------------- | :------------------------------------------ | :------------------------------------------------------ |
| **설계 목표**      | 수학적 증명을 통한 완벽한 안정성 보장       | **이해하기 쉽고 구현이 용이한 실용성** 강조             |
| **리더 구조**      | 명시적인 리더가 없고, 여러 노드가 제안 가능 | **명시적이고 강력한 단일 리더** 중심                    |
| **복잡성**         | **매우 높음**, 이해와 구현이 어려움         | 상대적으로 낮고, 직관적이며 이해하기 쉬움               |
| **핵심 아이디어**  | 2단계(Prepare/Accept) 합의 과정             | **리더 선출, 로그 복제, 안전성**으로 문제 분해          |
| **주요 사용 사례** | 이론 연구, 일부 특수 목적 시스템            | \*\*etcd, Consul 등 현대 분산 시스   \*\*에서 널리 사용 |

______________________________________________________________________

## 3. 예시 (Example)

### Raft 리더 선출 시나리오

1. **초기 상태**: 3개의 노드(A, B, C)가 모두 Follower 상태로 시작합니다.
1. **타임아웃**: 노드 B가 설정된 타임아웃 시간 동안 리더로부터 하트비트 신호를 받지 못합니다.
1. **선거 시작**: 노드 B는 자신의 임기(Term)를 1 증가시키고, 스스로에게 투표한 뒤 Candidate 상태가 되어 다른 노드(A, C)에게 투표를 요청합니다.
1. **투표**: 노드 A와 C는 아직 투표하지 않았으므로, 노드 B의 요청을 받고 투표합니다.
1. **리더 당선**: 노드 B는 자신을 포함하여 과반수(2/3)의 표를 얻었으므로 새로운 리더가 됩니다.
1. **상태 전파**: 리더가 된 노드 B는 다른 모든 노드에게 주기적으로 하트비트 신호를 보내 자신이 리더임을 알리고, 다른 노드들은 Follower 상태를 유지합니다.

______________________________________________________________________

## 4. 예상 면접 질문 (Potential Interview Questions)

- **Q. 분산 시스템에서 합의 알고리즘이 왜 필요한가요?**

  - **A.** 분산 시스템은 여러 노드가 독립적으로 동작하며 네트워크 장애나 노드 다운과 같은 문제가 발생할 수 있는 신뢰할 수 없는 환경입니다. 이러한 상황에서도 모든 노드가 데이  의 상태에 대해 동일한 값을 가지도록, 즉 데이터의 일관성과 무결성을 보장하기 위해 합의 알고리즘이 필수적입니다. 합의가 없다면 각 노드가 서로 다른 데이터를 가지게 되어 시스템 전체가 오작동할 수 있습니다.

- **Q. Paxos에 비해 Raft가 가지는 장점은 무엇인가요?**

  - **A.** Raft의 가장 큰 장점은 **이해하기 쉽고 구현하기 용이하다**는 점입니다. Paxos는 이론적으로 매우 강력하지만 지나치게 복잡하여 실제 시스템에 적용하기 어려운 반면, Raft는 합의 과정을 리더 선출, 로그 복제 등 여러 하위 문제로 명확하게 분리하고, 강력한 리더 중심의 단방향 데이터 흐름을 채택하여 개발자가 더 쉽게 이해하고 구현할 수 있도록 설계되었습니다.

- **Q. Raft 알고리즘에서 '로그 복제(Log Replication)'는 어떻게 데이터의 일관성을 보장하나요?**

  - **A.** Raft에서는 모든 데이터 변경(쓰기 요청)이 반드시 리더를 통해서만 이루어집니다. 리더는 이 변경 사항을 순서대로 로그에 기록하고, 이 로그를 모든 팔로워에게 복제합니다. 리더는 **과반수**의 팔로워가 해당 로그를 성공적으로 복제했다고 응답했을 때만, 그 로그를 '커밋'된 것으로 간주하고 클라이언트에게 성공을 알립니다. 이 '과반수 합의' 규칙 덕분에, 일부 노드에 장애가 발생하더라도 시스템 전체적으로는 항상 일관된 순서의 로그를 유지할 수 있습니다.

______________________________________________________________________

## 5. 더 읽어보기 (Further Reading)

- [The Raft Consensus Algorithm (Official Site)](https://raft.github.io/)
- [Paxos (Wikipedia)](<https://en.wikipedia.org/wiki/Paxos_(computer_science)>)
- [In Search of an Understandable Consensus Algorithm (Raft Paper)](https://raft.github.io/raft.pdf)
