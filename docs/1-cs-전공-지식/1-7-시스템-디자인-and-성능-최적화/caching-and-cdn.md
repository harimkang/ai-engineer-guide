---
title: "캐시 계층 & CDN 전략"
date: "2025-07-02"
tags: ["시스템 디자인", "CS", "캐시", "CDN"]
difficulty: "medium"
---

# 캐시 계층 & CDN 전략

## 1. 핵심 개념 (Core Concept)

**캐시(Cache)**는 데이터나 값을 미리 복사해두는 임시 저장소로, 향후 요청에 더 빠르게 응답하기 위해 사용됩니다. **캐시 계층(Cache Layer)**은 데이터베이스와 같이 상대적으로 느린 원본 데이터 저장소와 애플리케이션 사이에 위치하는 고속의 임시 데이터 저장 계층입니다. **CDN(Content Delivery Network)**은 지리적으로 분산된 여러 캐시 서버에 콘텐츠를 복제해두고, 사용자와 가장 가까운 서버에서 콘텐츠를 제공하여 전송 속도를 높이는 기술입니다. 이 두 기술은 시스템의 응답 속도를 향상시키고 백엔드 부하를 줄이는 핵심적인 역할을 합니다.

---

## 2. 상세 설명 (Detailed Explanation)

### 2.1 캐시 계층 (Cache Layer)

캐시 계층은 자주 사용되거나 계산 비용이 높은 데이터를 메모리(In-Memory)에 저장하여, 디스크 기반의 데이터베이스보다 훨씬 빠른 응답 속도를 제공합니다.

*   **동작 원리**:
    1.  애플리케이션이 데이터 요청을 보냅니다.
    2.  캐시 계층에서 해당 데이터가 있는지 확인합니다. (**Cache Hit**)
    3.  데이터가 존재하면 캐시에서 바로 가져와 응답합니다.
    4.  데이터가 없으면(**Cache Miss**) 원본 데이터 저장소(DB)에서 데이터를 조회합니다.
    5.  조회한 데이터를 캐시 계층에 저장하고 애플리케이션에 응답합니다.

*   **장점**: 성능 향상, DB 부하 감소, 비용 절감.
*   **단점**: 데이터 일관성 문제, 캐시 관리 리소스 증가.

#### 캐싱 전략 (Write Policies)

캐시와 원본 데이터 저장소 간의 데이터를 어떻게 동기화할 것인지 결정하는 방법입니다.

| 전략 | 동작 방식 | 장점 | 단점 | 주요 사용 사례 |
| :--- | :--- | :--- | :--- | :--- |
| **Write-Through** | 데이터를 쓸 때 **캐시와 DB에 동시에** 씀 | 높은 데이터 정합성, 데이터 유실 위험 낮음 | 쓰기 지연 시간 증가 | 금융 거래, 재고 관리 등 데이터 정합성이 매우 중요한 시스템 |
| **Write-Back** | **캐시에만 먼저 쓰고**, 특정 조건 만족 시 DB에 모아서     | 빠른 쓰기 속도, DB 부하 감소 | 데이터 유실 위험 존재 | 쓰기 작업이 매우 빈번한 대규모 로깅 시스템, 실시간 순위 집계 |
| **Write-Around** | **DB에만 쓰고** 캐시에는 저장하지 않음 (읽기 요청 시 캐시에 저장) | 불필요한 캐시 쓰기 방지, 빠른 쓰기 속도 | 쓰기 후 즉시 읽기 시 성능 저하 | 한번 쓰고 다시 읽지 않는 데이터, 대용량 데이터 일괄 쓰기 |

### 2.2 CDN (Content Delivery Network)

CDN은 정적 콘텐츠(이미지, 동영상, CSS, JS 파일 등)를 사용자와 물리적으로 가장 가까운 **에지 서버(Edge Server)**에서 전송하여 네트워크 지연(Latency)을 최소화하는 기술입니다.

*   **동작 원리**:
    1.  **콘텐츠 캐싱**: 원본 서버(Origin Server)의 콘텐츠를 전 세계 주요 거점에 분산된 CDN 에지 서버에 미리 복사해 둡니다.
    2.  **사용자 요청**: 사용자가 웹 콘텐츠를 요청하면, DNS는 사용자와 가장 가까운 CDN 에지 서버의 IP 주소로 안내합니다.
    3.  **빠른 전송**:
        *   **Cache Hit**: 요청한 콘텐츠가 에지 서버에 있으면, 즉시 사용자에게 전송합니다.
        *   **Cache Miss**: 콘텐츠가 에지 서버에 없으면, 원본 서버로부터 콘텐츠를 가져와 사용자에게 전달하고 다음 요청을 위해 에지 서버에 캐시합니다.

*   **장점**: 웹사이트 로딩 속도 개선, 원본 서버 부하 분산, 서비스 안정성 및 가용성 향상, 보안 강화(DDoS 방어).

---

## 3. 예시 (Example)

### 글로벌 소셜 미디어 서비스 디자인

**요구사항**: 전 세계 사용자에게 빠른 이미지/동영상 피드 제공, 실시간 '좋아요' 수 표시, 안정적인 서비스.

**적용 방안**:
1.  **CDN 적용 (정적 콘텐츠)**:
    *   사용자가 업로드하는 이미지, 동영상과 같은 **정적 콘텐츠**는 모두 CDN을 통해 제공합니다.
    *   이를 통해 사용자는 자신과 가장 가까운 서버에서 미디어를 빠르게 로딩하고, 원본 스토리지 서버의 부하를 최소화합니다.
2.  **캐시 계층 적용 (동적 데이터)**:
    *   **사용자 프로필, 게시물 정보, 친구 목록** 등 자주 조회되지만 자주 변경되지 않는 데이터는 캐시 계층(예: Redis, Memcached)에 저장합니다.
    *   **'좋아요' 수, 조회수**처럼 쓰기가 매우 빈번한 데이터는 **Write-Back** 전략을 사용하여 캐시에만 먼저 반영하고 일정 주기로 DB에 업데이트하여 쓰기 부하를 줄입니다.
    *   **게시물 수정**처럼 데이터 정합성이 중요한 작업은 **Write-Through** 전략을 사용하여 캐시와 DB에 동시에 업데이트합니다.

**시스템 아키텍처**:
```mermaid
graph TD;
    subgraph "사용자 디바이스"
        User[<fa:fa-user> 사용자]
    end

    subgraph "네트워크"
        CDN[<fa:fa-cloud> CDN (정적 콘텐츠)]
    end

    subgraph "애플리케이션 인프라"
        LB(로드 밸런서)
        subgraph "웹/앱 서버 (Stateless)"
            App1(앱 서버 1)
            App2(앱 서버 2)
            App3(...)
        end
        Cache[<fa:fa-database> 캐시 계층 (Redis)]
        DB[<fa:fa-database> 데이터베이스]
        Storage[<fa:fa-archive> 오브젝트 스토리지<br>(원본 이미지/영상)]
    end

    User --"이미지/영상 요청"--> CDN;
    User --"API 요청 (피드, 댓글)"--> LB;
    CDN --"Cache Miss 시"--> Storage;
    LB --> App1 & App2 & App3;
    App1 & App2 & App3 <--> Cache;
    Cache --"Cache Miss / Write"--> DB;
```

---

## 4. 예상 면접 질문 (Potential Interview Questions)

*   **Q. 캐시를 사용할 때 발생할 수 있는 가장 큰 문제점은 무엇이며, 이를 어떻게 해결할 수 있나요?**
    *   **A.** 가장 큰 문제점은 **데이터 일관성(Consistency)** 문제입니다. 원본 DB의 데이터가 변경되었을 때 캐시의 데이터가 즉시 갱신되지 않으면, 사용자에게 오래된 데이터가 제공될 수 있습니다. 이를 해결하기 위해, 데이터의 특성에 맞는 캐싱 전략(Write-Through, Write-Back 등)을 사용하거나, 데이터 변경 시 관련된 캐시를 명시적으로 삭제 또는 갱신하는 로직(Cache Invalidation)을 구현해야 합니다. 또한, 캐시에 TTL(Time-To-Live)을 설정하여 일정 시간이 지나면 데이터가 자동으로 만료되도록 하는 방법도 있습니다.

*   **Q. CDN과 브라우저 캐시의 차이점은 무엇인가요?**
    *   **A.** **브라우저 캐시**는 개별 사용자의 브라우저에 데이터를 저장하는 **사적인(private) 캐시**입니다. 한 번 방문한 사이트의 리소스를 저장해두어, 해당 사용자 개인의 재방문 속도를 높여줍니다. 반면, **CDN**은 여러 사용자에게 서비스를 제공하기 위해 네트워크의 여러 거점(에지 서버)에 데이터를 저장하는 **공유(shared) 캐시**입니다. CDN은 최초 방문자를 포함한 모든 사용자에게 빠른 로딩 속도를 제공하고, 서버의 부하를 분산시키는 역할을 합니다.

*   **Q. Write-Through 캐싱 전략과 Write-Back 캐싱 전략을 비교 설명해주세요.**
    *   **A.** **Write-Through**는 데이터를 쓸 때 캐시와 데이터베이스에 **동시에** 쓰는 전략입니다. 데이터 정합성이 높다는 장점이 있지만, 쓰기 작업이 두 곳에서 모두 완료되어야 하므로 쓰기 지연 시간이 길어집니다. **Write-Back**은 데이터를 **캐시에만 먼저 쓰고**, 나중에 DB에 모아서 쓰는 전략입니다. 쓰기 성능이 매우 빠르다는 장점이 있지만, 데이터가 DB에 반영되기 전에 캐시 서버에 장애가 발생하면 데이터가 유실될 위험이 있습니다.

---

## 5. 더 읽어보기 (Further Reading)

*   [Caching Strategies and How to Choose the Right One (AWS Blog)](https://aws.amazon.com/caching/caching-strategies/)
*   [What is a CDN? (Cloudflare)](https://www.cloudflare.com/learning/cdn/what-is-a-cdn/)
*   [System Design Interview - Caching (ByteByteGo)](https://bytebytego.com/courses/system-design-interview/caching)