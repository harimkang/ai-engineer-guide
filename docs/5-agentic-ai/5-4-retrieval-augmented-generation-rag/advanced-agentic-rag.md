---
title: '고급·Agentic RAG: 쿼리 변환, 다중 스텝, 툴 보강'
date: 2025-10-29
tags:
  - Agentic-AI
  - RAG
  - Agentic-RAG
  - Query-Transformation
difficulty: hard
---

# 고급 및 Agentic RAG

## 1. 핵심 개념 (Core Concept)

Agentic RAG는 단순한 '검색 후 답변'을 넘어, **에이전트가 스스로 판단하고, 질문을 분석하며, 여러 도구를 동원해 반복적으로 정보를 수집하고 검증**하여 최종 답변을 완성하는 가장 발전된 형태의 RAG입니다. 이는 RAG 파이프라인에 ReAct와 같은 에이전트 추론 루프를 결합한 것으로, 복잡하고 다각적인 질문에 대해 인간 전문가와 유사한 리서치 능력을 보여줍니다.

- **RAG의 진화**
  - **단순 RAG**: 질문 → 검색 → 답변. 한 번의 검색으로 끝나는 직선적 구조.
  - **고급 RAG**: 질문 → **쿼리 변환** → 검색 → **재정렬/압축** → 답변. 여전히 직선적이지만, 검색 전후처리 단계를 추가하여 품질을 높인 구조.
  - **Agentic RAG**: (질문 → **\[생각→행동(검색/툴)→관찰\]** → ...) → 답변. 검색 자체가 에이전트의 '행동' 중 하나가 되며, 필요에 따라 여러 번 반복되는 순환적/동적 구조.

*Note: 아래 다이어그램을 위한 이미지를 `docs/images/rag-spectrum-diagram.png` 에 추가해주세요.*
![RAG Spectrum Diagram](../../images/rag-spectrum-diagram.png)

______________________________________________________________________

## 2. 상세 설명 (Detailed Explanation)

Agentic RAG는 크게 검색 전, 검색, 검색 후 단계의 고급 기술들을 에이전트 루프 안에서 동적으로 활용합니다.

### 2.1 검색 전: 쿼리 변환 (Pre-retrieval: Query Transformation)

사용자의 원본 질문을 그대로 사용하지 않고, 더 나은 검색 결과를 얻기 위해 가공합니다.

- **쿼리 분해 (Decomposition / Self-Ask)**: 복잡한 질문을 여러 개의 간단한 하위 질문으로 나눕니다. (예: "인셉션을 감독한 사람의 최신작은?" → 1. "인셉션 감독은 누구?", 2. "그 사람의 최신작은?")
- **다중 쿼리 생성 (Multi-query)**: 모호한 질문에 대해 여러 관점의 쿼리를 생성하여 검색 범위를 넓힙니다. (예: "AI의 미래" → `["AI 기술 발전 전망", "AI의 사회적 영향", "AI 분야별 적용 사례"]`)
- **가상 문서 생성 (HyDE)**: 사용자의 질문에 대한 '가상적인 정답'을 먼저 생성한 뒤, 그 가상 정답과 유사한 실제 문서를 검색합니다. 전문 분야처럼 질문과 문서의 용어가 다를 때 효과적입니다.

### 2.2 검색: 다중 스텝 및 툴 보강 (Retrieval: Multi-step & Tool-augmented)

한 번의 검색으로 끝내지 않고, 여러 도구를 활용하여 증거를 누적하고 검증합니다.

- **다중 스텝 검색 (Multi-step Retrieval)**: 첫 검색 결과에서 얻은 단서(예: 특정 인물, 제품명)를 사용하여 다음 검색의 쿼리를 정교화하는 방식으로, 점진적으로 정보의 깊이를 더해갑니다.
- **툴 보강 (Tool-augmented Retrieval)**: 벡터 DB 검색뿐만 아니라, SQL 데이터베이스, 웹 검색 API, 계산기 등 다양한 도구를 동원하여 정량적 데이터, 최신 정보, 계산 결과 등을 수집합니다.

### 2.3 검색 후: 합성 및 근거 제시 (Post-retrieval: Synthesis & Grounding)

수집된 여러 정보를 종합하고, 신뢰도를 높이는 후처리 과정을 거칩니다.

- **재정렬 및 압축 (Re-ranking & Compression)**: 수집된 정보들 중 질문과 가장 관련성이 높은 순서대로 재정렬하고, 컨텍스트 예산에 맞게 요약/압축합니다. (자세한 내용은 5-2 참조)
- **정보 합성 및 근거 제시**: 여러 출처의 정보를 종합하여 일관된 답변을 생성하고, 각 내용의 근거가 된 출처(문서 ID, URL 등)를 명확히 인용하여 답변의 신뢰도를 높입니다.

______________________________________________________________________

## 3. 예상 면접 질문 및 모범 답안

### Q1. 언제 Agentic RAG가 과도한 복잡성이 될 수 있나요?

**A.** Agentic RAG는 **단순한 사실 확인 질문처럼, 기본적인 RAG 파이프라인만으로도 충분히 정확한 답변을 제공할 수 있는 경우**에 과도한 복잡성이 될 수 있습니다. 에이전틱 루프에서 오는 비용, 지연 시간, 구현 복잡도의 증가는 오직 다단계 추론과 여러 도구의 사용이 필수적인 복합적인 질문을 해결할 때만 정당화됩니다.

**\[추가 설명\]**

- **단순 RAG가 적합한 경우**: 사용자의 질문이 명확하고, 답이 단일 문서나 적은 수의 문서에서 발견될 수 있는 경우. (예: "우리 회사 복지 정책 알려줘?") 이 경우, 비용과 응답 속도가 더 중요합니다.
- **Agentic RAG가 필요한 경우**: 사용자의 질문이 모호하거나, 여러 정보를 종합해야 하거나, 최신 정보와 정형 데이터를 함께 조회해야 하는 경우. (예: "지난 분기 경쟁사들의 실적을 비교 분석하고, 시장 반응을 요약해줘.") 이 경우, 답변의 품질과 완전성이 비용보다 더 중요합니다.
- **결론**: '망치를 들면 모든 것이 못으로 보인다'는 함정을 피해야 합니다. 문제의 복잡도에 맞는 적절한 수준의 RAG 아키텍처를 선택하는 것이 중요합니다.

### Q2. HyDE, 다중 쿼리, 쿼리 분해는 각각 어떤 문제 유형에 가장 도움이 되나요?

**A.** **쿼리 분해**는 'A이면서 B인 것은?'과 같이 여러 조건이 결합된 복합 질문에, **다중 쿼리**는 'AI에 대해 알려줘'처럼 주제가 너무 광범위하고 모호한 질문에, **HyDE**는 사용자의 질문 용어와 문서의 전문 용어가 다른 특정 분야의 질문에 가장 효과적입니다.

**\[추가 설명\]**

- **쿼리 분해 (Decomposition)**: 여러 개의 하위 질문으로 이루어진 복합 질문을 해결하는 데 사용됩니다. (예: "그래미상을 수상한 최연소 아티스트의 데뷔 앨범은?")
- **다중 쿼리 (Multi-query)**: 사용자의 의도가 여러 갈래로 해석될 수 있는 모호한 질문에 대해, 가능한 모든 관점의 검색을 병렬로 수행하여 포괄적인 답변을 제공합니다. (예: "자율주행차의 현재" → `["자율주행 기술 레벨", "주요 자율주행차 모델", "자율주행 관련 법규"]`)
- **HyDE (Hypothetical Document Embeddings)**: 사용자의 질문에 대한 '가상의 완벽한 답변'을 먼저 생성하고, 그 답변과 가장 유사한 문서를 찾는 방식입니다. 질문과 문서 간의 용어 불일치가 심한 전문 분야(예: 법률, 의료)에서 검색 성능을 높이는 데 도움이 됩니다.

### Q3. Agentic RAG에서 중지 조건과 예산 제어는 어떻게 설계해야 하나요?

**A.** 중지 조건은 **1) 충분성, 2) 예산, 3) 정체**라는 세 가지 기준으로 설계하여, 무한 루프를 방지하고 비용을 제어해야 합니다. **충분성**은 '답변하기에 정보가 충분한가?'를, **예산**은 '설정한 비용/시간/횟수를 초과했는가?'를, **정체**는 '더 이상 새로운 정보를 얻지 못하고 있는가?'를 판단합니다.

**\[추가 설명\]**

1. **충분성 기반 중지**: 매 스텝마다 LLM에게 `"원래 질문에 답변하기에 현재까지 수집된 정보가 충분한가?"`라고 물어보고, '그렇다'고 답하면 루프를 종료합니다. 이는 가장 이상적인 '성공적 종료' 조건입니다.
1. **예산 기반 중지 (안전장치)**: 작업 전체에 대한 최대 단계 횟수(예: 5~7회), 최대 비용, 최대 실행 시간 등의 '하드 리밋'을 설정하고, 이 한도를 초과하면 즉시 루프를 중단시킵니다.
1. **정체 기반 중지 (효율성)**: 에이전트가 같은 행동을 반복하거나, 새로운 검색을 수행해도 이미 본 정보만 계속 얻는 등 더 이상 진행 상황이 없다고 판단될 때 루프를 중단시킵니다.

- **설계 원칙**: 성공적인 종료를 위한 '충분성' 조건과, 폭주를 막기 위한 '예산' 및 '정체'라는 안전장치를 함께 설계하는 것이 핵심입니다.

______________________________________________________________________

## 4. See also

- [기본 RAG 파이프라인](./basic-rag-pipeline.md)
- [메모리 아키텍처](../5-2-%EB%A9%94%EB%AA%A8%EB%A6%AC-and-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EA%B4%80%EB%A6%AC/memory-architecture.md)
- [컨텍스트 압축 및 관리](../5-2-%EB%A9%94%EB%AA%A8%EB%A6%AC-and-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EA%B4%80%EB%A6%AC/context-compression-management.md)
- [도구 스키마 및 프로토콜](../5-9-%EB%B3%B4%EC%95%88-and-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C/tool-schemas-jsonrpc-openapi.md)
